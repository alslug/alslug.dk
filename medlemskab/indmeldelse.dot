digraph indmeldelse {
  { # Dine handlinger
    node [ shape=box style=filled fillcolor=yellow ];
    indtast                [label="Du indtaster\ndine informationer\nher på siden"];
    subgraph cluster_server_sender_email {
      style=invis;
      node                 [label="Du bekræfter din email\nved at klikke på linket\ni den tilsendte mail\n\nHusk at checke dit spam-filter"];
      confirm_email_nyt_medlem;
      confirm_email_add_email [shape=point];
      confirm_email_add_mobil [shape=point];
    }
    subgraph cluster_server_sender_sms {
      style=invis;
      node                 [label="Du reagerer på SMS'en"];
      confirm_sms_nyt_medlem;
      confirm_sms_add_email [shape=point];
      confirm_sms_add_mobil [shape=point];
    }
  }
  send_tilmelding        [shape=folder label="Data gemmes krypteret \n på serveren \n \n INGEN kan se dine informatiner før \n du bekræfter din email."];
  { # Server-aktiviteter
    node [shape=component];
    subgraph cluster_server_sender_email {
      style=invis;
      node                 [label="Serveren sender \n en mail til dig hvor \n du skal bekræfte \n din tilmelding."];
      server_sender_emai_nyt_medlem;
      server_sender_email_add_email [shape=point];
      server_sender_email_add_mobil [shape=point];
    }
    subgraph cluster_server_sender_sms {
      style=invis;
      node                 [label="Serveren sender \n en SMS til dit \n mobil-nummer"];
      server_sender_sms_nyt_medlem;
      server_sender_sms_add_email [shape=point];
      server_sender_sms_add_mobil [shape=point];
    }
    subgraph cluster_sms_confirmed {
      style=invis;
      node                 [label="Serveren registrerer \n dit response"];
      sms_confirmed_nyt_medlem;
      sms_confirmed_add_email [shape=point];
      sms_confirmed_add_mobil [shape=point];
    }
  }
  { # Results
    node [shape=hexagon   style=filled fillcolor=green ];
    du_biver_medlem        [label="Du er nu blevet medlem"];
    mobile_ok              [label="Vi kan nu være sikre \n på at der er DIT \n mobil-nummer vi \n har registreret."]; 
    email_added            [label="Den nye \n ekstra email er \n registreret." shape=point];
    mobil_added            [label="Dit nye \n mobil-nummer er \n registreret." shape=point]; 
  }
  { # Valg
    node [shape=diamond];
    findes_allerede        [label="Kender vi \n allerde email \n og/eller eller \n mobil-nummer?"];
    hvad_findes_allerede   [label="Hvad \n findes \n allerede"];
  }

  indtast -> send_tilmelding -> findes_allerede;
                                findes_allerede ->                              server_sender_emai_nyt_medlem [label="Nej"];
                                                                                server_sender_emai_nyt_medlem -> confirm_email_nyt_medlem -> du_biver_medlem ->
                                                                                server_sender_sms_nyt_medlem  -> confirm_sms_nyt_medlem   -> sms_confirmed_nyt_medlem -> mobile_ok;
                                findes_allerede -> hvad_findes_allerede                                       [label="Ja"];
                                                   hvad_findes_allerede-> samme_member                        [label="Begge"];
                                                                          samme_member -> already_member_email;
                                                   hvad_findes_allerede -> server_sender_email_add_email      [label="Email"];
                                                                                server_sender_email_add_email -> confirm_email_add_email  ->
                                                                                server_sender_sms_add_email   -> confirm_sms_add_email    -> sms_confirmed_add_email -> email_added;
                                                   hvad_findes_allerede ->      server_sender_email_add_mobil [label="Mobil"];
                                                                                server_sender_email_add_mobil -> confirm_email_add_mobil  ->
                                                                                server_sender_sms_add_mobil   -> confirm_sms_add_mobil    -> sms_confirmed_add_mobil -> mobil_added;
}
